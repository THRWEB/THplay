<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Join Solo Match - THplay</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#111] text-white font-sans">

  <!-- Header -->
  <div class="flex justify-between items-center px-4 py-2 bg-gray-900">
    <div class="flex items-center cursor-pointer" onclick="window.location.href='main.html'">
      <div class="text-2xl mr-2">üè†</div>
    </div>
    <div id="walletDisplay" class="text-yellow-400 font-bold text-sm sm:text-base">Wallet: ‚Çπ0</div>
  </div>

  <!-- Selected Match Card Display -->
  <div id="matchCard" class="bg-gray-800 rounded-xl p-4 m-4">
    <img id="matchImage" src="" class="w-full rounded mb-2">
    <h2 id="matchTitle" class="text-xl font-bold">Loading Match...</h2>
    <p>Entry Fee: ‚Çπ<span id="matchEntryFee">--</span></p>
    <p>Prize Per Kill: ‚Çπ<span id="matchPrize">--</span></p>
    <p>Map: <span id="matchMap">--</span></p>
    <p>Time: <span id="matchTime">--</span></p>
    <p>Slots: <span id="matchSlot">--</span></p>
  </div>

  <!-- Join Form -->
  <div class="m-4 p-4 bg-gray-900 rounded">
    <h3 class="text-lg font-semibold mb-2">Enter In-Game Name</h3>
    <input id="inGameName" type="text" class="w-full p-2 rounded text-black" placeholder="Your Free Fire Name"/>
    <button id="joinBtn" class="mt-4 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded w-full">
      Join Match
    </button>
  </div>

  <!-- Firebase & Match Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBcLtCEmRCkUTwO0TaMk4piYiIHcZfjJjk",
      authDomain: "thplay-b3c68.firebaseapp.com",
      projectId: "thplay-b3c68",
      storageBucket: "thplay-b3c68.appspot.com",
      messagingSenderId: "243301774162",
      appId: "1:243301774162:web:be1d08fd88dd3edb90008b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const userRef = doc(db, "users", user.uid);
        onSnapshot(userRef, (docSnap) => {
          if (docSnap.exists()) {
            const wallet = docSnap.data().wallet || 0;
            document.getElementById("walletDisplay").textContent = `Wallet: ‚Çπ${wallet}`;
          }
        });

        // Load selected match from localStorage
        const selectedMatch = JSON.parse(localStorage.getItem("selectedMatch"));
        if (selectedMatch) {
          document.getElementById("matchImage").src = selectedMatch.image || "";
          document.getElementById("matchTitle").textContent = `${selectedMatch.matchId} - ${selectedMatch.time}`;
          document.getElementById("matchEntryFee").textContent = selectedMatch.entryFee || "--";
          document.getElementById("matchPrize").textContent = selectedMatch.prize || "--";
          document.getElementById("matchMap").textContent = selectedMatch.map || "--";
          document.getElementById("matchTime").textContent = selectedMatch.time || "--";
          document.getElementById("matchSlot").textContent = selectedMatch.slot || "--";
        } else {
          document.getElementById("matchCard").innerHTML = "<p class='text-center text-red-500'>No match selected!</p>";
        }

        // Join button logic (placeholder)
        document.getElementById("joinBtn").addEventListener("click", () => {
          const name = document.getElementById("inGameName").value.trim();
          if (name === "") {
            alert("Please enter your in-game name.");
            return;
          }
          alert(`Joining match as "${name}"...`);
          // TODO: Implement match joining logic here
        });

      } else {
        window.location.href = "index.html";
      }
    });
  </script>
</body>
</html>
